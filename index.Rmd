---
title: "Bego"
author: "Thomas Huet"
date: "11/12/2020"
header-includes:
  # - \usepackage{float}
  # - \floatplacement{figure}{H}  #make every figure with capti
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width = 10, fig.height = 10)
# opts_chunk$set(fig.width=12, fig.height=8)
library(kableExtra)
library(dplyr)
library(knitr)
library(magick)
library(leaflet)
library(RPostgreSQL)
library(rdrop2)
library(rgl)
library(plotly)

GHimgs <- "https://github.com/zoometh/C14/tree/main/docs/imgs/"

df.corresp.thm <- data.frame(prem=c("A","C","F","H","N","P","R","T","X"),
                             thm=c("Axes/Tools","Horned fig.","Halberd","Anthropomorph",
                                   "Unfigurative","Dagger","Reticulated/Topographic","Yoke",
                                   "Special fig."),
                             colors=c("green","red","lightgreen","blue","grey",                                                                                  "darkgreen","yellow","orange","darkgrey"),
                             stringsAsFactors = F)
thm.not.selected <- c("A","N","X")
# source("func/functions.R") # load/run ? function
# f.lflt.chef(getwd()) # create leaflet html map of the CdT
```

# The site

The site is divided into 7 sectors

```{r lf.Sectors}
# load the lf map from img/CdT.html
# knitr::include_url("https://yihui.shinyapps.io/miniUI/")
# knitr::include_app(paste0(getwd(),"/img/m.html"), height = '600px')
htmltools::includeHTML(paste0(getwd(),"/img/Bego.html"))
```

## The engravings

Figuratives:

```{r lf.figures, fig.width=7, fig.height=5}
# TODO: color chart by c'colors' field
figures <- read.table("img/FIGURES.csv", sep = ",", header = T, stringsAsFactors = F)
figures$zone <- as.factor(figures$zone)
figures$prem <- toupper(figures$prem)
figures.prem.sum <- figures %>% count(prem, zone)
figures.prem.sum <- figures.prem.sum[figures.prem.sum$prem != '',] # rm NA
figures.prem.sum <- figures.prem.sum[!(figures.prem.sum$prem %in% thm.not.selected),] # rm N
# merge to get thm fullname and colors
figures.prem.sum <- merge(figures.prem.sum,df.corresp.thm,by="prem",all.x=T)
figures.prem.sum$lbl <- paste0(figures.prem.sum$thm,'<br>n = ',as.character(figures.prem.sum$n))
fig.count <- figures.prem.sum %>%
  plot_ly(x = ~zone,
          y = ~n,
          type = 'bar', 
          text = ~lbl,
          hoverinfo = 'text',
          hovertext = ~lbl,
          name = ~thm,
          color = ~thm) %>%
  layout(yaxis = list(title = 'Count'), barmode = 'stack')
fig.count
```

# Impressive rocks

## *Roche de l'Homme aux bras en zigzag* (Zone IV, Groupe III, Roche 16D)

In the Arpette sector lies the *Roche de l'Homme aux bras en zigzag* 

```{r lf.HBZZ}
# load the lf map from img/CdT.html
# knitr::include_url("https://yihui.shinyapps.io/miniUI/")
# knitr::include_app(paste0(getwd(),"/img/m.html"), height = '600px')
htmltools::includeHTML(paste0(getwd(),"/img/ZIVGIIIR16D.html"))
```

## *Stèle du Chef de Tribu* (Zone VII, Groupe I, Roche 8)

In the vallées de Merveilles lies the unique stelae of the site, the so-called *Stèle du Chef de Tribu*


### Map 

```{r lf.CdT}
# load the lf map from img/CdT.html
# knitr::include_url("https://yihui.shinyapps.io/miniUI/")
# knitr::include_app(paste0(getwd(),"/img/m.html"), height = '600px')
htmltools::includeHTML(paste0(getwd(),"/img/CdT.html"))
```

This is really important..

## New paragraph

Near..
