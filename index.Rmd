---
title: "Bego"
author: "Thomas Huet"
date: "11/12/2020"
header-includes:
  # - \usepackage{float}
  # - \floatplacement{figure}{H}  #make every figure with capti
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width = 10, fig.height = 10)
# opts_chunk$set(fig.width=12, fig.height=8)
library(kableExtra)
library(dplyr)
library(knitr)
library(magick)
library(leaflet)
library(RPostgreSQL)
library(rdrop2)
library(rgl)
library(plotly)

GHimgs <- "https://github.com/zoometh/C14/tree/main/docs/imgs/"

df.corresp.sect <- data.frame(LabelSect=c("Me","Fo","Vr","Sm","Cs","Vm","Go","Vb"),
                              sectors=c("Les Merveilles","Fontananlba","Valaurette",                                                                      "Sainte-Marie","Valmasque","Col du Sabion","Gordolasque","Vei del Bouc"),
                              stringsAsFactors = F)
df.corresp.thm <- data.frame(prem=c("A","C","F","H","N","P","R","T","X"),
                             thm=c("Axes/Tools","Horned fig.","Halberd","Anthropomorph",
                                   "Unfigurative","Dagger","Reticulated/Topographic","Yoke",
                                   "Special fig."),
                             colors=c("green","red","lightgreen","blue","grey",                                                                                  "darkgreen","yellow","orange","darkgrey"),
                             stringsAsFactors = F)
thm.not.selected <- c("A","N","X")
# source("func/functions.R") # load/run ? function
# f.lflt.chef(getwd()) # create leaflet html map of the CdT
```

# The site

The site is divided into 7 sectors. Main ones are [**Les Merveilles** sector][] and [**Fontanalba** sector][]

```{r df.Sectors}
roches <- read.table("img/ROCHES.csv", sep = ";", header = T, stringsAsFactors = F)
# merge to get full names of sectors
roches <- merge(roches,df.corresp.sect,by="LabelSect",all.x = TRUE)
sect.roches.count <- roches %>%
  group_by(sectors) %>%
  summarise(nb.rocks=n())
# order
sect.roches.count <- sect.roches.count[with(sect.roches.count, order(-nb.rocks)), ]
kable(sect.roches.count,"html") %>%
  kable_styling(full_width = FALSE, position = "center", font_size=12)

```

The entire site is about 900 ha, with the large majority of engraved rocks in the France territory but also a sector in between France and Italy (**Col du Sabion** sector) and a rock in Italy (**Vei del Bouc** sector)  

```{r lf.Sectors}
htmltools::includeHTML(paste0(getwd(),"/img/Bego.html"))
```

## The engravings

There's about 20,000 figuratives pecked engravings

```{r lf.figures, fig.width=7, fig.height=5}
# TODO: color chart by c'colors' field
figures <- read.table("img/FIGURES.csv", sep = ",", header = T, stringsAsFactors = F)
figures$zone <- as.factor(figures$zone)
figures$prem <- toupper(figures$prem)
figures.prem.sum <- figures %>% count(prem, zone)
figures.prem.sum <- figures.prem.sum[figures.prem.sum$prem != '',] # rm NA
figures.prem.sum <- figures.prem.sum[!(figures.prem.sum$prem %in% thm.not.selected),] # rm N
# merge to get thm fullname and colors
figures.prem.sum <- merge(figures.prem.sum,df.corresp.thm,by="prem",all.x=T)
figures.prem.sum$lbl <- paste0(figures.prem.sum$thm,'<br>n = ',as.character(figures.prem.sum$n))
fig.count <- figures.prem.sum %>%
  plot_ly(x = ~zone,
          y = ~n,
          type = 'bar', 
          text = ~lbl,
          hoverinfo = 'text',
          hovertext = ~lbl,
          name = ~thm,
          color = ~thm) %>%
  layout(yaxis = list(title = 'Count'), barmode = 'stack')
fig.count
```

The Zone 13 (**Valaurette** sector) shows a distinctive profile with almost only topographic figure

## Altitudes

<!-- roches$lbl.r <- paste0(roches$zone,'.',roches$groupe,'.',roches$roche) -->
<!-- figures$lbl.r <- paste0(figures$zone,'.',figures$groupe,'.',figures$roche) -->

# Impressive rocks

## *Roche de l'Homme aux bras en zigzag* (Zone IV, Groupe III, Roche 16D)

In the Arpette sector lies the *Roche de l'Homme aux bras en zigzag* 

```{r lf.HBZZ}
# load the lf map from img/CdT.html
# knitr::include_url("https://yihui.shinyapps.io/miniUI/")
# knitr::include_app(paste0(getwd(),"/img/m.html"), height = '600px')
htmltools::includeHTML(paste0(getwd(),"/img/ZIVGIIIR16D.html"))
```

## *Stèle du Chef de Tribu* (Zone VII, Groupe I, Roche 8)

In the vallées de Merveilles lies the unique stelae of the site, the so-called *Stèle du Chef de Tribu*


```{r lf.CdT}
# load the lf map from img/CdT.html
# knitr::include_url("https://yihui.shinyapps.io/miniUI/")
# knitr::include_app(paste0(getwd(),"/img/m.html"), height = '600px')
htmltools::includeHTML(paste0(getwd(),"/img/ZVIIGIR8.html"))
```


## Sectors

### **Les Merveilles** sector

This is really important..

### **Fontanalba** sector

This is really important..

## New paragraph

Near..
